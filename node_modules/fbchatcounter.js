var login = require('facebook-chat-api');

var http = require('http');
var io = require('socket.io');
var server = http.createServer(app);
server.listen(port);
var io = io.listen(server);

login({email: "stanmaeyens@hotmail.com", password: "cerclekampioen1"}, function callback (err, api) {
    if(err) return console.error(err);

    api.searchForThread('Smooth skidinkkamp/s.t.n', function callback (err, obj) {
    	console.log('found: ' + obj[0].name + ", " + obj[0].threadID);

    	api.getThreadHistory(obj[0].threadID, 0, 100000, null, function callback (err, history){
    		console.log('history');
    		//console.log(history);
    		var counter = 0;
    		var counterpp = [];
    		var wordspp = [];
    		var counterpd = [];
    		var counterpw = [];
    		for(var i=0; i<history.length; i++){
    			counter++;
    			if(counterpp[history[i].senderName]){
    				counterpp[history[i].senderName]++;
    			}
    			else{
    				counterpp[history[i].senderName] = 1;
    			}
    			if(wordspp[history[i].senderName]){
    				if(history[i].type === 'message' && history[i].body){
    					var message = history[i].body;
    					var words = message.split(" ");
    					wordspp[history[i].senderName] += words.length;
    				}
    			}
    			else{
    				if(history[i].type === 'message' && history[i].body){
    					var message = history[i].body;
    					var words = message.split(" ");
    					wordspp[history[i].senderName] = words.length;
    				}
    			}
    			if(counterpd[history[i].timestampAbsolute]){
    				counterpd[history[i].timestampAbsolute]++;
    			}
    			else{
    				counterpd[history[i].timestampAbsolute] = 1;
    			}
    			//console.log("sender: " + history[i].senderName + ", message: " + history[i].body);
    		}

    		console.log("aantal berichten = " + counter);
    		console.log("per persoon (# woorden; #woorden/bericht): ");
    		for(var p in counterpp){
    			console.log(p + ": " + counterpp[p] + " (" + wordspp[p] + "; " + Math.round( wordspp[p]/counterpp[p] * 100) / 100 + ")");
    		}
    		console.log("\nper dag: ");
    		for(var d in counterpd){
    			console.log(d + ": " + counterpd[d]);
    		}
    	});
    });
});
